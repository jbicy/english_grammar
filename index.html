<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜ä¸­è‹±æ–‡ç‰¹è¨“ç­ï¼šGrammar Elite</title>
    <style>
        :root {
            /* æ·±è‰²ç³»ä¸»é¡Œï¼Œé©åˆé«˜ä¸­ç”Ÿå°ˆæ³¨å­¸ç¿’ */
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --primary: #38bdf8;   /* äº®è—è‰² */
            --accent: #818cf8;    /* ç´«è—è‰² */
            --success: #10b981;
            --error: #f43f5e;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --border: #334155;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* --- Header --- */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        h1 {
            font-size: 2rem;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .subtitle {
            color: var(--text-sub);
            font-size: 1rem;
        }

        /* --- Grid Menu --- */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .topic-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .topic-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .topic-num {
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .topic-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-main);
        }

        .topic-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }
        
        .tag {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.05);
            color: var(--text-sub);
        }
        .tag.highlight {
            background: rgba(56, 189, 248, 0.15);
            color: var(--primary);
            border: 1px solid rgba(56, 189, 248, 0.3);
        }

        /* --- Game Interface --- */
        #game-interface {
            display: none;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .game-bar {
            background: rgba(0,0,0,0.2);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .btn-text {
            background: none;
            border: none;
            color: var(--text-sub);
            cursor: pointer;
            font-size: 0.95rem;
            padding: 5px 10px;
            transition: color 0.2s;
        }
        .btn-text:hover { color: var(--text-main); }

        .concept-box {
            background: rgba(56, 189, 248, 0.05); /* Very light blue tint */
            padding: 25px;
            border-left: 4px solid var(--primary);
        }
        .concept-title {
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .concept-content {
            color: var(--text-main);
            font-size: 0.95rem;
        }
        .concept-content strong { color: var(--accent); }

        .quiz-area {
            padding: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--border);
            margin-bottom: 25px;
            border-radius: 2px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }

        .question {
            font-size: 1.3rem;
            font-weight: 500;
            margin-bottom: 30px;
            min-height: 80px;
            display: flex;
            align-items: center;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr; /* Mobile first */
            gap: 15px;
        }
        @media (min-width: 600px) {
            .options { grid-template-columns: 1fr 1fr; }
        }

        .opt-btn {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 18px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            position: relative;
        }

        .opt-btn:hover:not(:disabled) {
            background: rgba(255,255,255,0.08);
            border-color: var(--text-sub);
        }

        .opt-btn.correct { background: rgba(16, 185, 129, 0.2); border-color: var(--success); }
        .opt-btn.wrong { background: rgba(244, 63, 94, 0.2); border-color: var(--error); }

        .explanation {
            margin-top: 25px;
            padding: 20px;
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            display: none;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .next-btn {
            display: none;
            margin-top: 20px;
            background: var(--primary);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            float: right;
        }
        .next-btn:hover { background: #7dd3fc; }

        /* --- Result --- */
        #result-view {
            display: none;
            text-align: center;
            padding: 60px 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 4px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            margin: 0 auto 30px;
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.3);
        }
        .action-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
        }

    </style>
</head>
<body>

<div class="container">
    <header id="main-header">
        <h1>é«˜ä¸­è‹±æ–‡ç‰¹è¨“ç­ Grammar Elite</h1>
        <div class="subtitle">é‡å°å­¸æ¸¬/åˆ†ç§‘è¨­è¨ˆ â€¢ 14 å¤§æ ¸å¿ƒæ–‡æ³•å–®å…ƒ</div>
    </header>

    <!-- Menu View -->
    <div id="menu-view" class="menu-grid"></div>

    <!-- Game Interface -->
    <div id="game-interface">
        <div class="game-bar">
            <button class="btn-text" onclick="showMenu()">â® EXIT</button>
            <span style="color:var(--text-sub); font-size:0.9rem;" id="level-indicator">UNIT 01</span>
        </div>
        
        <div class="concept-box" id="concept-area"></div>

        <div class="quiz-area">
            <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
            <div class="question" id="question-text"></div>
            <div class="options" id="options-area"></div>
            
            <div class="explanation" id="explanation-area"></div>
            <button class="next-btn" id="next-btn" onclick="nextQuestion()">NEXT QUESTION â”</button>
            <div style="clear:both;"></div>
        </div>
    </div>

    <!-- Result View -->
    <div id="result-view">
        <h2 style="color:var(--text-sub)">UNIT COMPLETE</h2>
        <div class="score-circle" id="final-score">100</div>
        <p id="result-msg">Excellent job!</p>
        <button class="action-btn" onclick="showMenu()">Return to Dashboard</button>
    </div>
</div>

<script>
    /*
      Data Structure designed for High School Syllabus
      Complexity Level: CEFR B1/B2
    */
    const syllabus = [
        {
            id: 1,
            title: "å¥å­çµæ§‹èˆ‡äº”å¤§å¥å‹",
            tags: ["Sentence Structure", "Clasues"],
            concept: "<strong>äº”å¤§å¥å‹</strong>æ±ºå®šå¥å­çš„éª¨æ¶ (S+V+O+C)ã€‚<br>æ³¨æ„<strong>åè©å­å¥</strong>ç•¶ä¸»è©/å—è©ï¼Œ<strong>å½¢å®¹è©å­å¥</strong>ä¿®é£¾åè©ï¼Œä»¥åŠé€£æ¥è©çš„é‚è¼¯ã€‚",
            questions: [
                { q: "We found the movie ___.", options: ["bored", "boringly", "boring", "bore"], ans: 2, explain: "æœ¬å¥ç‚º S+V+O+C (æ„Ÿå®˜/è¦ºå¾—)ã€‚å—è© the movie æ˜¯äº‹ç‰©ï¼Œè£œèªç”¨ V-ing (ä»¤äºº...çš„)ï¼Œæ•…é¸ boringã€‚" },
                { q: "___ he will come is still unknown.", options: ["That", "What", "Which", "If"], ans: 3, explain: "é€™è£¡éœ€è¦ä¸€å€‹åè©å­å¥ç•¶ä¸»è©ã€‚If (æ˜¯å¦) å¼•å°åè©å­å¥æ™‚ï¼Œé€šå¸¸ä¸æ”¾å¥é¦– (å¥é¦–ç¿’æ…£ç”¨ Whether)ï¼Œä½†åœ¨å£èªæˆ–æ­¤é¸é …ä¸­ï¼Œè‹¥ç„¡ Whetherï¼ŒThat è¡¨ç¤ºã€Œé€™ä»¶äº‹ã€æ˜¯ç¢ºå®šçš„ï¼Œä½†å¥æ„æ˜¯ unknown (æœªçŸ¥)ï¼Œæ•… If/Whether èªæ„æ‰é€šã€‚ä½†æ­£å¼æ–‡æ³•å¥é¦–ç”¨ Whetherï¼Œæ­¤é¡Œè‹¥é¸ That èªæ„çŸ›ç›¾ã€‚ä¿®æ­£ï¼šæ­¤é¡Œæ„åœ¨è€ƒ Whether/That å€åˆ¥ã€‚è‹¥é¸é …æ”¹ç‚º [That, Whether, What, Which]ï¼Œæ‡‰é¸ Whetherã€‚æ­¤è™•è‹¥é¸ That ä»£è¡¨ã€Œä»–æœƒä¾†ã€é€™ä»¶äº‹æ˜¯æœªçŸ¥çš„(é‚è¼¯æ€ª)ã€‚æœ€ä½³è§£æ‡‰æ˜¯ Whetherï¼Œè‹¥ç„¡ Whetherï¼Œæ­¤é¡Œè¨­è¨ˆæ„åœ¨è€ƒåè©å­å¥å®Œæ•´æ€§ï¼Œé¸ That æ–‡æ³•å°ä½†èªæ„æ€ªï¼›é¸ If å¥é¦–å°‘è¦‹ã€‚è®“æˆ‘å€‘ä¿®æ­£é¡Œç›®ç‚ºæ¨™æº–è€ƒæ³•ï¼š'___ he is rich or not doesn't matter.' -> Whetherã€‚" }, // ä¿®æ­£ç‚ºæ›´ç²¾ç¢ºçš„é¡Œç›®
                { q: "The reason ___ he was late was simply unknown.", options: ["which", "why", "that", "because"], ans: 1, explain: "å…ˆè¡Œè©æ˜¯ The reasonï¼Œé—œä¿‚å‰¯è©ç”¨ why (æˆ– that)ã€‚" },
                { q: "He is rich, ___ he is not happy.", options: ["so", "but", "therefore", "however"], ans: 1, explain: "é€—è™Ÿé€£æ¥å…©å€‹å­å¥ï¼Œéœ€è¦å°ç­‰é€£æ¥è© (and/but/or)ã€‚However æ˜¯å‰¯è©ï¼Œä¸èƒ½å–®ç¨é€£æ¥å…©å€‹å­å¥(éœ€ç”¨åˆ†è™Ÿ)ã€‚" }
            ]
        },
        {
            id: 2,
            title: "é€²éšæ™‚æ…‹æ•´åˆ",
            tags: ["Perfect Tense", "Future"],
            concept: "é«˜ä¸­é‡é»ï¼š<strong>å®Œæˆé€²è¡Œå¼</strong> (ä¸€ç›´æŒçºŒåˆ°æŸæ™‚)ã€<strong>æœªä¾†å®Œæˆå¼</strong> (åˆ°æœªä¾†æŸæ™‚å°‡å·²ç¶“...)ã€éå»å®Œæˆå¼ (æ¯”éå»æ›´æ—©)ã€‚",
            questions: [
                { q: "By next year, I ___ here for ten years.", options: ["will live", "will have lived", "have lived", "am living"], ans: 1, explain: "çœ‹åˆ° 'By next year' (åˆ°æ˜å¹´ç‚ºæ­¢) + 'for ten years' (æŒçºŒä¸€æ®µæ™‚é–“)ï¼Œéœ€ç”¨ã€Œæœªä¾†å®Œæˆå¼ã€(will have p.p.)ã€‚" },
                { q: "When I arrived at the station, the train ___.", options: ["left", "has left", "had left", "was leaving"], ans: 2, explain: "æˆ‘åˆ°é”(éå»å¼)ä¹‹å‰ï¼Œç«è»Šã€Œå·²ç¶“ã€èµ°äº†(æ¯”éå»æ›´æ—©)ï¼Œç”¨ã€Œéå»å®Œæˆå¼ã€(had p.p.)ã€‚" },
                { q: "She is tired because she ___ all day.", options: ["is working", "has been working", "worked", "had worked"], ans: 1, explain: "ç¾åœ¨è¦ºå¾—ç´¯ï¼Œæ˜¯å› ç‚ºã€Œå¾éå»ä¸€ç›´æŒçºŒåˆ°ç¾åœ¨ã€çš„å‹•ä½œï¼Œç”¨ã€Œç¾åœ¨å®Œæˆé€²è¡Œå¼ã€(has been V-ing)ã€‚" }
            ]
        },
        {
            id: 3,
            title: "åŠ©å‹•è©èˆ‡å‡è¨­æ¨æ¸¬",
            tags: ["Modals", "Assumption"],
            concept: "é‡é»ï¼š<strong>åŠ©å‹•è© + have p.p.</strong> è¡¨å°éå»çš„æ¨æ¸¬æˆ–æƒ‹æƒœã€‚<br>Must have p.p. (ä¸€å®šå·²ç¶“)ã€Should have p.p. (æœ¬è©²åšå»æ²’åš)ã€‚",
            questions: [
                { q: "The ground is wet. It ___ last night.", options: ["must rain", "should rain", "must have rained", "should have rained"], ans: 2, explain: "å°ã€Œéå»ã€äº‹å¯¦çš„å¼·çƒˆæ¨æ¸¬(ä¸€å®šæœ‰ä¸‹é›¨)ï¼Œç”¨ must have p.p.ã€‚" },
                { q: "You ___ me the truth, but you didn't.", options: ["should tell", "must tell", "should have told", "must have told"], ans: 2, explain: "ã€Œæœ¬ä¾†æ‡‰è©²åš...ä½†å¯¦éš›ä¸Šæ²’åšã€ï¼Œç”¨ should have p.p.ã€‚" },
                { q: "He ___ be at home; I saw him in the park just now.", options: ["mustn't", "can't", "shouldn't", "won't"], ans: 1, explain: "è¡¨ç¤ºã€Œä¸å¯èƒ½ã€(å¦å®šæ¨æ¸¬)ï¼Œç”¨ can't (cannot)ã€‚mustn't æ˜¯ã€Œç¦æ­¢ã€ã€‚" }
            ]
        },
        {
            id: 4,
            title: "è¢«å‹•èªæ…‹é€²éš",
            tags: ["Passive Voice"],
            concept: "æ³¨æ„ï¼š<strong>é€²è¡Œå¼çš„è¢«å‹•</strong> (being p.p.)ã€<strong>å®Œæˆå¼çš„è¢«å‹•</strong> (been p.p.) ä»¥åŠçœç•¥ by çš„æƒ…æ³ã€‚",
            questions: [
                { q: "The new bridge is currently ___.", options: ["building", "been built", "being built", "built"], ans: 2, explain: "ç¾åœ¨é€²è¡Œå¼çš„è¢«å‹•ï¼šis/am/are + being + p.p.ã€‚æ©‹æ­£åœ¨ã€Œè¢«ã€è“‹ã€‚" },
                { q: "The problem has already ___.", options: ["solved", "been solved", "being solved", "solving"], ans: 1, explain: "ç¾åœ¨å®Œæˆå¼çš„è¢«å‹•ï¼šhave/has + been + p.p.ã€‚" },
                { q: "He was seen ___ the house.", options: ["enter", "to enter", "entering", "entered"], ans: 1, explain: "æ„Ÿå®˜å‹•è©(see)æ”¹è¢«å‹•æ™‚ï¼ŒåŸå½¢å‹•è©(enter)è¦è®Šå›ä¸å®šè©(to enter)ã€‚" }
            ]
        },
        {
            id: 5,
            title: "åè©ã€ä»£åè©èˆ‡é—œä»£",
            tags: ["Nouns", "Pronouns"],
            concept: "é—œä¿‚ä»£åè©ï¼šWho(äººä¸»æ ¼), Whom(äººå—æ ¼), Which(ç‰©), That(é€šç”¨), Whose(æ‰€æœ‰æ ¼)ã€‚ä¸å®šä»£åè© Both/Either/Neitherã€‚",
            questions: [
                { q: "The professor ___ I respect is retiring.", options: ["who", "whom", "which", "what"], ans: 1, explain: "å…ˆè¡Œè© Professor æ˜¯äººï¼Œä¸”åœ¨å­å¥ä¸­ç•¶ respect çš„ã€Œå—è©ã€ï¼Œæ­£å¼ç”¨æ³•ç”¨ Whom (å£èªå¯ç”¨ Who)ã€‚" },
                { q: "He has two sons; ___ of them are doctors.", options: ["all", "both", "either", "none"], ans: 1, explain: "å…©è€…éƒ½...ç”¨ Bothã€‚All ç”¨æ–¼ä¸‰è€…ä»¥ä¸Šã€‚" },
                { q: "I have a friend ___ father is a pilot.", options: ["who", "whom", "whose", "which"], ans: 2, explain: "è¡¨ç¤ºã€Œä»–çš„ã€çˆ¶è¦ªï¼Œç”¨æ‰€æœ‰æ ¼é—œä»£ Whoseã€‚" }
            ]
        },
        {
            id: 6,
            title: "å½¢å®¹è©èˆ‡å‰¯è©æ¯”è¼ƒ",
            tags: ["Comparison", "Transition"],
            concept: "å€æ•¸æ¯”è¼ƒï¼š<strong>twice as adj as</strong>ã€‚<br>é€£æ¥å‰¯è©ï¼šHowever (ç„¶è€Œ), Therefore (å› æ­¤), Moreover (æ­¤å¤–)ï¼Œéœ€ç”¨åˆ†è™Ÿæˆ–å¥é»éš”é–‹ã€‚",
            questions: [
                { q: "This room is ___ that one.", options: ["twice big as", "twice as big as", "as twice big as", "twice bigger than"], ans: 1, explain: "å€æ•¸ç”¨æ³•ï¼šå€æ•¸ + as + adj + asã€‚" },
                { q: "He studied hard; ___, he failed the test.", options: ["therefore", "moreover", "however", "otherwise"], ans: 2, explain: "èªæ„è½‰æŠ˜ (åŠªåŠ›ä½†å¤±æ•—)ï¼Œç”¨ However (ç„¶è€Œ)ã€‚" },
                { q: "Of the two boys, Tom is the ___.", options: ["taller", "tallest", "more tall", "tall"], ans: 0, explain: "ã€Œå…©è€…ã€ä¹‹ä¸­è¼ƒ...ï¼Œé›–ç„¶æœ‰ theï¼Œä½†å…©è€…æ¯”è¼ƒä»ç”¨æ¯”è¼ƒç´š (the taller)ã€‚ä¸‰è€…ä»¥ä¸Šæ‰ç”¨æœ€é«˜ç´šã€‚" }
            ]
        },
        {
            id: 7,
            title: "ç‰¹æ®Šå‹•è©å½¢å¼",
            tags: ["Causative", "Senses"],
            concept: "ä½¿å½¹å‹•è©ï¼šMake/Have/Let + åŸV (ä¸»å‹•)ã€‚Get + to Vã€‚<br>æ„Ÿå®˜å‹•è©ï¼šSee/Hear + åŸV (å…¨ç¨‹) æˆ– V-ing (æ­£åœ¨)ã€‚",
            questions: [
                { q: "I got him ___ the car.", options: ["wash", "to wash", "washing", "washed"], ans: 1, explain: "Get ç•¶ä½¿å½¹å‹•è©(å«æŸäººåš)æ™‚ï¼Œä¸»å‹•èªæ…‹è¦æ­é… to Vã€‚" },
                { q: "The boss made us ___ overtime.", options: ["work", "to work", "working", "worked"], ans: 0, explain: "Make (å¼·è¿«) + O + åŸå½¢å‹•è©ã€‚" },
                { q: "I felt the house ___.", options: ["shook", "to shake", "shaking", "shake to"], ans: 2, explain: "æ„Ÿå®˜å‹•è© feel + O + Ving (è¡¨ç¤ºæ„Ÿè¦ºåˆ°æ­£åœ¨æ–æ™ƒ) æˆ– åŸå½¢ã€‚" }
            ]
        },
        {
            id: 8,
            title: "ä»‹ä¿‚è©èˆ‡ç‰‡èª",
            tags: ["Prepositions"],
            concept: "é«˜ä¸­å¸¸ç”¨ç‰‡èªï¼šAccording to (æ ¹æ“š), Because of (å› ç‚º), Instead of (ä»£æ›¿), In spite of (å„˜ç®¡)ã€‚",
            questions: [
                { q: "The game was canceled ___ the rain.", options: ["because", "due", "because of", "since"], ans: 2, explain: "the rain æ˜¯åè©ï¼Œå‰é¢è¦ç”¨ä»‹ä¿‚è©ç‰‡èª Because ofã€‚Because å¾Œé¢è¦æ¥å­å¥ã€‚" },
                { q: "___ the bad weather, we went hiking.", options: ["Although", "In spite of", "Even if", "Because of"], ans: 1, explain: "å„˜ç®¡å¤©æ°£ä¸å¥½ (åè©ç‰‡èª)ï¼Œç”¨ In spite ofã€‚Although å¾Œé¢è¦æ¥å­å¥ã€‚" },
                { q: "I'll have tea ___ coffee.", options: ["instead", "instead of", "replace", "exchange"], ans: 1, explain: "Instead of (ä»£æ›¿/è€Œä¸æ˜¯) + åè©ã€‚" }
            ]
        },
        {
            id: 9,
            title: "é€²éšé€£æ¥è©",
            tags: ["Conjunctions"],
            concept: "é›–ç„¶ï¼šAlthough/Thoughã€‚é™¤éï¼šUnless (=If not)ã€‚<br>ä¸€æ—¦ï¼šAs soon asã€‚åªè¦ï¼šProvided thatã€‚",
            questions: [
                { q: "You will fail ___ you study harder.", options: ["if", "unless", "when", "because"], ans: 1, explain: "Unless = If...notã€‚å¥æ„ï¼šä½ æœƒå¤±æ•—ï¼Œã€Œé™¤éã€ä½ æ›´åŠªåŠ›è®€æ›¸ã€‚" },
                { q: "___ he is rich, he is stingy.", options: ["Despite", "In spite of", "Although", "However"], ans: 2, explain: "he is rich æ˜¯å­å¥ï¼Œç”¨é€£æ¥è© Although (é›–ç„¶)ã€‚Despite æ¥åè©ã€‚" },
                { q: "I will leave ___ he arrives.", options: ["as soon as", "so that", "unless", "provided"], ans: 0, explain: "As soon as (ä¸€...å°±...)ã€‚" }
            ]
        },
        {
            id: 10,
            title: "å­å¥èˆ‡å€’è£",
            tags: ["Clauses", "Inversion"],
            concept: "é™å®š vs éé™å®š(é€—è™Ÿ)ã€‚<br>å¦å®šå‰¯è©æ”¾å¥é¦–çš„å€’è£ï¼šNever/Rarely/Only then + åŠ©å‹•è© + S + Vã€‚",
            questions: [
                { q: "Only then ___ realize my mistake.", options: ["I did", "did I", "I had", "had I"], ans: 1, explain: "Only + æ™‚é–“å‰¯è©æ”¾å¥é¦–ï¼Œå¥å­è¦å€’è£ (åŠ©å‹•è©ç§»åˆ°ä¸»è©å‰)ã€‚" },
                { q: "My father, ___ lives in Taipei, is a doctor.", options: ["that", "who", "which", "whom"], ans: 1, explain: "éé™å®šç”¨æ³• (æœ‰é€—è™Ÿ)ï¼Œè£œå……èªªæ˜ç¨ä¸€ç„¡äºŒçš„å°è±¡ï¼Œä¸èƒ½ç”¨ Thatï¼Œäººè¦ç”¨ Whoã€‚" },
                { q: "Never ___ such a beautiful sight.", options: ["I have seen", "have I seen", "did I see", "I saw"], ans: 1, explain: "Never æ”¾å¥é¦–ï¼Œå€’è£ã€‚å®Œæˆå¼å€’è£ï¼šHave + S + p.p.ã€‚" }
            ]
        },
        {
            id: 11,
            title: "åˆ†è©æ§‹å¥ (é«˜éšå¿…è€ƒ)",
            tags: ["Participles"],
            concept: "<strong>åˆ†è©æ§‹å¥</strong>ï¼šç°¡åŒ–å­å¥ã€‚<br>ä¸»å‹•ç”¨ V-ingï¼Œè¢«å‹•ç”¨ p.p.ã€‚æ³¨æ„çœç•¥çš„ä¸»è©å¿…é ˆèˆ‡ä¸»è¦å­å¥ä¸»è©ä¸€è‡´ã€‚",
            questions: [
                { q: "___ by the dog, the boy cried.", options: ["Biting", "Bit", "Bitten", "To bite"], ans: 2, explain: "ç”·å­©æ˜¯ã€Œè¢«ã€ç‹—å’¬ï¼Œçœç•¥äº† Because he was...ï¼Œä¿ç•™ p.p. (Bitten)ã€‚" },
                { q: "___ the room, I saw a spider.", options: ["Entered", "Entering", "Enter", "To enter"], ans: 1, explain: "æˆ‘é€²å…¥æˆ¿é–“ (ä¸»å‹•)ï¼Œçœç•¥ When I entered...ï¼Œæ”¹ç‚º V-ing (Entering)ã€‚" },
                { q: "The girl ___ in the corner is my sister.", options: ["stands", "standing", "stood", "is standing"], ans: 1, explain: "å½¢å®¹è©å­å¥ç°¡åŒ–ï¼šThe girl (who is) standing...ï¼Œä¸»å‹•ç”¨ V-ing ä¿®é£¾åè©ã€‚" }
            ]
        },
        {
            id: 12,
            title: "ç›´æ¥èˆ‡é–“æ¥å¼•èª",
            tags: ["Reported Speech"],
            concept: "æ™‚æ…‹å¾Œé€€ï¼šç¾åœ¨â†’éå»ï¼Œéå»â†’éå®Œã€‚<br>ç–‘å•å¥æ”¹é–“æ¥å•å¥ï¼šAsk if/whether... æˆ– Ask wh-word + S + Vã€‚",
            questions: [
                { q: "He said, 'I am busy.' â†’ He said that he ___ busy.", options: ["is", "was", "were", "had been"], ans: 1, explain: "ä¸»è¦å‹•è© said æ˜¯éå»å¼ï¼Œå¼•è™Ÿå…§çš„ am è¦é€€ä¸€æ­¥è®Šæˆ wasã€‚" },
                { q: "She asked me ___.", options: ["where was I", "where I was", "where am I", "I was where"], ans: 1, explain: "é–“æ¥å•å¥ä¸å€’è£ï¼Œé †åºç‚ºï¼šç–‘å•è© + S + Vã€‚" },
                { q: "Tom said he ___ the movie before.", options: ["saw", "has seen", "had seen", "sees"], ans: 2, explain: "ä»–èªªè©±æ™‚(éå»)ï¼Œçœ‹é›»å½±æ˜¯ã€Œæ›´æ—©ä¹‹å‰ã€çš„äº‹ï¼Œæ•…ç”¨éå»å®Œæˆå¼ had seenã€‚" }
            ]
        },
        {
            id: 13,
            title: "è™›ä¸»è©èˆ‡åˆ†è£‚å¥",
            tags: ["It patterns"],
            concept: "è™›ä¸»è©ï¼šIt is adj to Vã€‚<br>åˆ†è£‚å¥(å¼·èª¿)ï¼šIt is ... that ... (æ­£æ˜¯...ç™¼ç”Ÿäº†...)ã€‚",
            questions: [
                { q: "It is important for us ___ English.", options: ["learn", "learning", "to learn", "learned"], ans: 2, explain: "è™›ä¸»è© It ... to V å¥å‹ã€‚" },
                { q: "It was John ___ broke the window.", options: ["who", "which", "what", "whom"], ans: 0, explain: "å¼·èª¿å¥ It is/was X that/who...ã€‚å¼·èª¿äººå¯ç”¨ who æˆ– thatã€‚" },
                { q: "I found ___ difficult to finish the job.", options: ["that", "this", "it", "x"], ans: 2, explain: "è™›å—è© itã€‚I found it adj to Vã€‚" }
            ]
        },
        {
            id: 14,
            title: "æ–‡æ„æ¨è«–èˆ‡å…‹æ¼å­—",
            tags: ["Reading Grammar"],
            concept: "ç¶œåˆæ‡‰ç”¨ï¼šåˆ¤æ–·ä»£åè©æŒ‡æ¶‰å°è±¡ã€é€£æ¥è©çš„é‚è¼¯é—œä¿‚ã€å­å¥çµæ§‹åˆ†æã€‚",
            questions: [
                { q: "Technology helps us; ___, it creates new problems.", options: ["similarly", "for example", "on the other hand", "consequently"], ans: 2, explain: "å‰å¥è¬›å¥½è™•(help)ï¼Œå¾Œå¥è¬›å£è™•(problems)ï¼Œèªæ°£è½‰æŠ˜ï¼Œé¸ On the other hand (å¦ä¸€æ–¹é¢)ã€‚" },
                { q: "Students ___ study hard will succeed.", options: ["who", "which", "whom", "where"], ans: 0, explain: "é—œä¿‚ä»£åè©ç•¶ä¸»è©ï¼Œä¿®é£¾ Students (äºº)ï¼Œç”¨ Whoã€‚" },
                { q: "Some agree, while ___ disagree.", options: ["another", "other", "others", "the other"], ans: 2, explain: "Some... others... (æœ‰äº›äºº...å¦æœ‰äº›äºº...) çš„å›ºå®šç”¨æ³•ã€‚" }
            ]
        }
    ];

    // --- Core Logic ---
    let currentUnit = null;
    let currentQIndex = 0;
    let score = 0;
    let correctCount = 0;

    const menuView = document.getElementById('menu-view');
    const gameInterface = document.getElementById('game-interface');
    const resultView = document.getElementById('result-view');
    const header = document.getElementById('main-header');

    // Init
    function init() {
        syllabus.forEach(item => {
            // Update Syllabus Question Text for logic fix in ID 1
            if(item.id === 1) {
                 item.questions[1].q = "___ he comes or not doesn't matter. (è«‹é¸å‡ºæœ€ä½³é€£æ¥è©)";
                 item.questions[1].options = ["That", "Whether", "What", "Which"];
                 item.questions[1].ans = 1;
                 item.questions[1].explain = "Whether...or not æ˜¯æ¨™æº–çš„åè©å­å¥ç”¨æ³•ï¼Œè¡¨ã€Œæ˜¯å¦ã€ã€‚";
            }

            const card = document.createElement('div');
            card.className = 'topic-card';
            card.onclick = () => loadUnit(item.id);
            
            let tagsHtml = item.tags.map(t => `<span class="tag ${t==='Participles'?'highlight':''}">${t}</span>`).join('');

            card.innerHTML = `
                <div class="card-header">
                    <span class="topic-num">UNIT ${item.id.toString().padStart(2, '0')}</span>
                </div>
                <div class="topic-title">${item.title}</div>
                <div class="topic-tags">${tagsHtml}</div>
            `;
            menuView.appendChild(card);
        });
    }

    function loadUnit(id) {
        currentUnit = syllabus.find(u => u.id === id);
        currentQIndex = 0;
        score = 0;
        correctCount = 0;

        menuView.style.display = 'none';
        header.style.display = 'none';
        resultView.style.display = 'none';
        gameInterface.style.display = 'block';

        document.getElementById('level-indicator').innerText = `UNIT ${id.toString().padStart(2, '0')} : ${currentUnit.title}`;
        document.getElementById('concept-area').innerHTML = `
            <div class="concept-title">âš¡ High School Grammar Point</div>
            <div class="concept-content">${currentUnit.concept}</div>
        `;

        renderQuestion();
    }

    function renderQuestion() {
        const qData = currentUnit.questions[currentQIndex];
        
        // UI Reset
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('explanation-area').style.display = 'none';
        const progress = ((currentQIndex) / currentUnit.questions.length) * 100;
        document.getElementById('progress-fill').style.width = `${progress}%`;

        document.getElementById('question-text').innerText = `${currentQIndex + 1}. ${qData.q}`;
        
        const optsDiv = document.getElementById('options-area');
        optsDiv.innerHTML = '';

        qData.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(idx, btn);
            optsDiv.appendChild(btn);
        });
    }

    function checkAnswer(selectedIdx, btnElement) {
        const qData = currentUnit.questions[currentQIndex];
        const allBtns = document.querySelectorAll('.opt-btn');
        allBtns.forEach(b => b.disabled = true);

        const isCorrect = selectedIdx === qData.ans;
        
        if (isCorrect) {
            btnElement.classList.add('correct');
            score += 100 / currentUnit.questions.length;
            correctCount++;
        } else {
            btnElement.classList.add('wrong');
            allBtns[qData.ans].classList.add('correct');
        }

        const explainDiv = document.getElementById('explanation-area');
        explainDiv.innerHTML = `<strong>${isCorrect ? 'Correct!' : 'Incorrect.'}</strong><br>${qData.explain}`;
        explainDiv.style.display = 'block';
        explainDiv.style.borderColor = isCorrect ? 'var(--success)' : 'var(--error)';

        document.getElementById('next-btn').style.display = 'block';
        
        // Update progress bar to next step logic visually
        document.getElementById('progress-fill').style.width = `${((currentQIndex + 1) / currentUnit.questions.length) * 100}%`;
    }

    function nextQuestion() {
        if (currentQIndex < currentUnit.questions.length - 1) {
            currentQIndex++;
            renderQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        gameInterface.style.display = 'none';
        resultView.style.display = 'block';
        
        const finalScore = Math.round(score);
        const scoreEl = document.getElementById('final-score');
        const msgEl = document.getElementById('result-msg');
        
        scoreEl.innerText = finalScore;
        
        if (finalScore === 100) {
            scoreEl.style.borderColor = "var(--success)";
            msgEl.innerText = "Perfect! You've mastered this topic. ğŸ“";
        } else if (finalScore >= 60) {
            scoreEl.style.borderColor = "var(--primary)";
            msgEl.innerText = "Good job! Review the mistakes and try again. ğŸ‘";
        } else {
            scoreEl.style.borderColor = "var(--error)";
            msgEl.innerText = "Keep practicing! Don't give up. ğŸ’ª";
        }
    }

    function showMenu() {
        gameInterface.style.display = 'none';
        resultView.style.display = 'none';
        menuView.style.display = 'grid';
        header.style.display = 'block';
    }

    init();
</script>

</body>
</html>